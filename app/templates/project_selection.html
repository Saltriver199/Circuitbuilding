<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Railway XLSX Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Train Favicon using emoji -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸš†</text></svg>">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('main.project_selection') }}">ðŸš† Railway XLSX Builder</a>
    <div class="ms-auto">
      <!-- ADDED: Back to Homepage button in navbar -->
      <a class="btn btn-outline-success me-2" href="{{ url_for('main.index') }}">
        <i class="bi bi-house"></i> Back to Homepage
      </a>
      <a class="btn btn-outline-light" href="{{ url_for('main.new_project') }}">
        <i class="bi bi-plus-circle"></i> New Project
      </a>
    </div>
  </div>
</nav>

<main class="container py-4">
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-info">
        {% for m in messages %}<div>{{ m }}</div>{% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="text-center mb-4">
    <h2><i class="bi bi-folder-open"></i> Select a Railway Project</h2>
    <p class="text-muted">Choose an existing project or create a new one to start building your railway XLSX files.</p>
  </div>

  {% if projects_data %}
  <div class="row">
    {% for data in projects_data %}
    <div class="col-md-6 col-lg-4 mb-4">
      <div class="card h-100 {% if data.total_rows > 0 %}border-success{% else %}border-secondary{% endif %}">
        <div class="card-header d-flex justify-content-between align-items-center">
          <strong>
            <span class="badge bg-primary me-2">ID: {{ data.project.id }}</span>
            {{ data.project.name }}
          </strong>
          {% if data.total_rows > 0 %}
          <span class="badge bg-success">{{ data.total_rows }} records</span>
          {% else %}
          <span class="badge bg-secondary">Empty</span>
          {% endif %}
        </div>
        <div class="card-body">
          {% if data.project.description %}
          <p class="card-text">{{ data.project.description }}</p>
          {% else %}
          <p class="card-text text-muted">No description provided</p>
          {% endif %}
          
          <div class="small text-muted mb-3">
            <i class="bi bi-calendar-plus"></i> Created: {{ data.project.created_date.strftime('%d %b %Y at %I:%M %p IST') }}<br>
            {% if data.project.updated_date != data.project.created_date %}
            <i class="bi bi-arrow-clockwise"></i> Updated: {{ data.project.updated_date.strftime('%d %b %Y at %I:%M %p IST') }}<br>
            {% endif %}
            <i class="bi bi-database"></i> Total Records: <strong>{{ data.total_rows }}</strong>
          </div>
        </div>
        <div class="card-footer text-center">
          <a href="{{ url_for('main.switch_project', project_id=data.project.id) }}" 
             class="btn {% if data.total_rows > 0 %}btn-success{% else %}btn-primary{% endif %} w-100">
            <i class="bi bi-arrow-right-circle"></i> 
            {% if data.total_rows > 0 %}Continue Working{% else %}Start Project{% endif %}
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  
  <div class="text-center mt-4">
    <p class="text-muted">Total Projects: {{ projects_data|length }}</p>
  </div>
  
  {% else %}
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card border-primary">
        <div class="card-body text-center py-5">
          <i class="bi bi-folder-plus display-1 text-primary mb-3"></i>
          <h4>No Projects Found</h4>
          <p class="text-muted mb-4">
            It looks like you haven't created any railway projects yet. 
            Get started by creating your first project!
          </p>
          <a href="{{ url_for('main.new_project') }}" class="btn btn-primary btn-lg">
            <i class="bi bi-plus-circle"></i> Create Your First Project
          </a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="text-center mt-4">
    <!-- ADDED: Back to Homepage button -->
    <a href="{{ url_for('main.index') }}" class="btn btn-success me-2">
      <i class="bi bi-house"></i> Back to Homepage
    </a>
    <a href="{{ url_for('main.new_project') }}" class="btn btn-outline-primary btn-lg">
      <i class="bi bi-plus-circle"></i> Create New Project
    </a>
  </div>
</main>
</body>
</html>
